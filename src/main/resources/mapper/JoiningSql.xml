<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.JoiningMapper">
     <insert id="insertJoin" parameterType="JoiningDto">
        insert into joining (unum,jcontent,jwriteday,jjoinday,gname,jprice,jtime,jage) values (#{unum},#{jcontent},now(),#{jjoinday},#{gname},#{jprice},#{jtime},#{jage})
     </insert>
    <select id="getJoiningList" resultType="JoiningDto">
        select *,(select count(jm.jnum) from joinmember jm where jn.jnum = jm.jnum and jm.jaccept=1) as jmcount from joining jn order by jnum desc
    </select>
    <select id="detailPage" parameterType="int" resultType="JoiningDto">
        select *, (select count(jm.jnum) from joinmember jm where j.jnum = jm.jnum and jm.jaccept=1) as jmcount, (select count(jm.jnum) from joinmember jm where j.jnum = jm.jnum and jm.jaccept=0) as smcount from joining j inner join user u on j.unum = u.unum where j.jnum=#{jnum}
    </select>
    <delete id="joinCancel" parameterType="int">
        delete from joining where jnum=#{jnum}
    </delete>
    <insert id="joinMaker" parameterType="JoinmemberDto">
        insert into joinmember (unum,jnum,jaccept) values (#{unum},#{jnum},1)
    </insert>
</mapper>